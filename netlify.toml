# Netlify 配置文件
# 文档: https://docs.netlify.com/configure-builds/file-based-configuration/

[build]
  # 基础目录保持在根目录，这样可以读取 .node-version
  base = "/"
  
  # 构建命令：先安装 website 依赖，再构建
  command = "cd website && npm install && npm run build"
  
  # 发布目录 - 使用 Next.js plugin 时会自动处理
  publish = "website/.next"
  
  # 忽略某些文件的变更（不触发构建）
  ignore = "git diff --quiet $CACHED_COMMIT_REF $COMMIT_REF -- . ':(exclude)website'"

[build.environment]
  # Node.js 版本（会优先使用根目录的 .node-version，这里作为备用）
  NODE_VERSION = "24"
  
  # npm 配置
  NPM_FLAGS = "--legacy-peer-deps"

# Netlify Essential Next.js Plugin - 自动处理 Next.js 部署
[[plugins]]
  package = "@netlify/plugin-nextjs"
  
  [plugins.inputs]
    # 启用图片优化
    imageOptimization = true

# 开发预览配置
[context.deploy-preview]
  command = "cd website && npm install && npm run build"

[context.branch-deploy]
  command = "cd website && npm install && npm run build"

# 生产环境配置
[context.production]
  command = "cd website && npm install && npm run build"
